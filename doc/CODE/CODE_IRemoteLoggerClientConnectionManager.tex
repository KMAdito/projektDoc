\begin{spacing}{0.75}
	\begin{javacode}
/**
 * Implementierung eines RemoteLoggerClientConnectionManagers.
 * Dieser dient als Zwischenstelle von außen auf die ClientConnection,
 * damti diese bei Bedarf ausgewechselt werden kann
 *
 * @author W.Glanzer, 20.11.2015
 */
public abstract class AbstractRemoteLoggerClientConnectionManager 
  implements IRemoteLoggerClientConnectionManager
{
  private final List<IRemoteLoggerListener> listenerList = new ArrayList<>();
  private final IRemoteLoggerListener listenerController = new _ControllingListener();
  private IRemoteLoggerClientConnection currentConnection;

  @Override
  public void shutdown() throws AditoIOException
  {
    try
    {
      disconnect();
      synchronized (listenerList)
      {
        listenerList.clear();
      }
    }
    catch(Exception e)
    {
      throw new AditoIOException(e, 16, 203);
    }
  }

  @Override
  public void connect(Locale pLocale) throws AditoIOException
  {
    try
    {
      currentConnection = createConnection();
      if(currentConnection != null)
      {
        currentConnection.addListener(listenerController);
        currentConnection.connect();

        // Sprache einstellen
        currentConnection.sendCommand(new LanguageCommand(pLocale));
      }
    }
    catch(Exception e)
    {
      throw new AditoIOException(e, 16, 204);
    }
  }

  @Override
  public void disconnect() throws AditoIOException
  {
    try
    {
      if (currentConnection != null)
      {\end{javacode}
\end{spacing}
\begin{spacing}{0.75}
	\begin{javacode}[firstnumber=60]
        currentConnection.close();
        currentConnection.removeListener(listenerController);
        currentConnection = null;
      }
    }
    catch (Exception e)
    {
      throw new AditoIOException(e, 16, 205);
    }
  }

  @Override
  public void addListener(IRemoteLoggerListener pLoggerListener)
  {
    synchronized (listenerList)
    {
      listenerList.add(pLoggerListener);
    }
  }

  @Override
  public void removeListener(IRemoteLoggerListener pLoggerListener)
  {
    synchronized (listenerList)
    {
      listenerList.remove(pLoggerListener);
    }
  }

  /**
   * Erstellt die Connection
   *
   * @return Die Connection
   */
  @Nullable
  protected abstract IRemoteLoggerClientConnection createConnection() 
    throws AditoException;

  /**
   * Listener der Nachrichten von der Connection
   * an alle eingehängten RemoteLogger verteilt
   */
  private class _ControllingListener implements IRemoteLoggerListener
  {
    @Override
    public void connectionStatusChanged(boolean pIsConnectedNow)
    {
      synchronized (listenerList)
      {
        listenerList.forEach(pLoggerListener -> 
          pLoggerListener.connectionStatusChanged(pIsConnectedNow));
      }
    }

    @Override
    public void checkPointReceived(@NotNull IRemoteLoggerCheckPoint pCheckPoint)
    {
      synchronized (listenerList)
      {
        listenerList.forEach(pLoggerListener ->
          pLoggerListener.checkPointReceived(pCheckPoint));
      }
    }
  }
}\end{javacode}
\end{spacing}